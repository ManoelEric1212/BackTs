generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RelacaoAtivos {
  codBem        String @id
  descricao     String
  modeloProd    String
  fabricaProd   String
  dataAquisicao String
  endereco      String
  local         String
  valorCompra   String
  valorResidual String
  grupo         String

  itensConferidos ItemConferencia[]
}

model Usuario {
  id        String   @id @default(uuid())
  email     String   @unique
  senha     String
  nome      String
  sobrenome String
  cracha    String   @unique
  cargo     String
  foto      String?
  criadoEm  DateTime @default(now())

  conferenciasCriadas Conferencia[]     @relation("ConferenciasCriadas")
  participacoes       Participacao[]
  ItemConferencia     ItemConferencia[]
}

model Conferencia {
  id              String            @id @default(uuid())
  titulo          String
  ambiente        String
  descricao       String?
  status          StatusConferencia @default(EM_ANDAMENTO)
  dataCriacao     DateTime          @default(now())
  dataFinalizacao DateTime?
  criadorId       String
  criador         Usuario           @relation("ConferenciasCriadas", fields: [criadorId], references: [id])

  itensConferidos ItemConferencia[]
  participantes   Participacao[]
}

model Participacao {
  id            String      @id @default(uuid())
  usuarioId     String
  conferenciaId String
  usuario       Usuario     @relation(fields: [usuarioId], references: [id])
  conferencia   Conferencia @relation(fields: [conferenciaId], references: [id])

  @@unique([usuarioId, conferenciaId])
}

model ItemConferencia {
  id              String  @id @default(uuid())
  codBem          String
  localVerificado String
  pertence        Boolean
  localReal       String?

  usuarioId String?
  usuario   Usuario? @relation(fields: [usuarioId], references: [id])

  conferenciaId String
  conferencia   Conferencia   @relation(fields: [conferenciaId], references: [id])
  ativo         RelacaoAtivos @relation(fields: [codBem], references: [codBem])
}

enum StatusConferencia {
  EM_ANDAMENTO
  FINALIZADA
}
